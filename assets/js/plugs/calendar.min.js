!function(){function a(b,c){c=c||{},$.extend(this,a.DEFAULT_OPTS,c),this.calWrap=$(b),this.build()}a.DEFAULT_OPTS={month_names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],short_month_names:["1","2","3","4","5","6","7","8","9","10","11","12"],short_day_names:["日","一","二","三","四","五","六"],start_of_week:1},a.prototype={build:function(){var a=$('<p class="month_nav"><span class="button prev" title="上一月">&#171;</span> <span class="month_name"></span> <span class="button next" title="下一月">&#187;</span></p>');this.monthNameSpan=$(".month_name",a),$(".prev",a).click(this.bindToObj(function(){this.moveMonthBy(-1)})),$(".next",a).click(this.bindToObj(function(){this.moveMonthBy(1)}));var b=$('<p class="year_nav"><span class="button prev" title="上一年">&#171;</span> <span class="year_name"></span> <span class="button next" title="下一年">&#187;</span></p>');this.yearNameSpan=$(".year_name",b),$(".prev",b).click(this.bindToObj(function(){this.moveMonthBy(-12)})),$(".next",b).click(this.bindToObj(function(){this.moveMonthBy(12)}));var c=$('<div class="nav"></div>').append(a,b),d="<table><thead><tr>";$(this.adjustDays(this.short_day_names)).each(function(){d+="<th>"+this+"</th>"}),d+="</tr></thead><tbody></tbody></table>",this.dateSelector=this.rootLayers=$('<div class="calendar_selector"></div>').append(c,d).appendTo(this.calWrap),$.browser.msie&&$.browser.version<7&&(this.ieframe=$('<iframe class="calendar_selector_ieframe" frameborder="0" src="#"></iframe>').insertBefore(this.dateSelector),this.rootLayers=this.rootLayers.add(this.ieframe),$(".button",c).mouseover(function(){$(this).addClass("hover")}),$(".button",c).mouseout(function(){$(this).removeClass("hover")})),this.tbody=$("tbody",this.dateSelector),this.selectDate(),this.initialize()},selectMonth:function(a){var b=new Date(a.getFullYear(),a.getMonth(),1);if(!this.currentMonth||this.currentMonth.getFullYear()!=b.getFullYear()||this.currentMonth.getMonth()!=b.getMonth()){this.currentMonth=b;for(var c=this.rangeStart(a),d=this.rangeEnd(a),e=this.daysBetween(c,d),f="",g=0;g<=e;g++){var h=new Date(c.getFullYear(),c.getMonth(),c.getDate()+g,12,0);this.isFirstDayOfWeek(h)&&(f+="<tr>"),h.getMonth()==a.getMonth()?(h=new Date(h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()),h.getTime()>=this.startTime.getTime()&&h.getTime()<=this.endTime.getTime()?f+=h.getTime()>this.curTime.getTime()?'<td class="selectable_day enable_use_day" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>":h.getTime()==this.curTime.getTime()?'<td class="selectable_day" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>":'<td class="selectable_day enable_use_day has_use_day" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>":(h.getTime()>this.endTime.getTime()||h.getTime()<this.startTime.getTime())&&(f+='<td class="selectable_day" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>")):f+='<td class="unselected_month" date="'+this.dateToString(h)+'"></td>',this.isLastDayOfWeek(h)&&(f+="</tr>")}this.tbody.empty().append(f),this.monthNameSpan.empty().append(this.monthName(a)),this.yearNameSpan.empty().append(this.currentMonth.getFullYear()),$("td[date="+this.dateToString(new Date)+"]",this.tbody).addClass("today"),$("td.selectable_day",this.tbody).mouseover(function(){$(this).addClass("hover")}),$("td.selectable_day",this.tbody).mouseout(function(){$(this).removeClass("hover")})}$(".selected",this.tbody).removeClass("selected"),$("td[date="+this.selectedDateString+"]",this.tbody).addClass("selected")},selectDate:function(a){a||(a=new Date),this.selectedDate=a,this.selectedDateString=this.dateToString(this.selectedDate),this.selectMonth(this.selectedDate)},dateToString:function(a){return a.getFullYear()+"-"+this.short_month_names[a.getMonth()]+"-"+a.getDate()},moveMonthBy:function(a){var b=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+a,this.currentMonth.getDate());this.selectMonth(b)},monthName:function(a){return this.month_names[a.getMonth()]},bindToObj:function(a){var b=this;return function(){return a.apply(b,arguments)}},indexFor:function(a,b){for(var c=0;c<a.length;c++)if(b==a[c])return c},shortDayNum:function(a){return this.indexFor(this.short_day_names,a)},daysBetween:function(a,b){return a=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),b=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()),(b-a)/864e5},changeDayTo:function(a,b,c){var d=c*(Math.abs(b.getDay()-a-7*c)%7);return new Date(b.getFullYear(),b.getMonth(),b.getDate()+d)},rangeStart:function(a){return this.changeDayTo(this.start_of_week,new Date(a.getFullYear(),a.getMonth()),-1)},rangeEnd:function(a){return this.changeDayTo((this.start_of_week-1)%7,new Date(a.getFullYear(),a.getMonth()+1,0),1)},isFirstDayOfWeek:function(a){return a.getDay()==this.start_of_week},isLastDayOfWeek:function(a){return a.getDay()==(this.start_of_week-1)%7},adjustDays:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[(c+this.start_of_week)%7];return b}},$.fn.calendar=function(b){return this.each(function(){new a(this,b)})}}();